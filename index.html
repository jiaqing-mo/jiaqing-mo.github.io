<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Expectancy: A Global Story</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    <script src="https://d3js.org/d3-annotation.v2.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .story-controls {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }
        
        .story-nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .story-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            background: #3498db;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }
        
        .story-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .story-btn.active {
            background: #e74c3c;
        }
        
        .visualization {
            padding: 30px;
            min-height: 600px;
            position: relative;
        }
        
        .chart-container {
            width: 100%;
            height: 500px;
            margin: 20px 0;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            pointer-events: none;
            z-index: 1000;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        
        .story-text {
            margin: 20px 0;
            line-height: 1.6;
            font-size: 16px;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 20px;
            background: #95a5a6;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            display: none;
        }
        
        .back-btn:hover {
            background: #7f8c8d;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 18px;
            color: #666;
        }
        
        .country-highlight {
            stroke: #e74c3c;
            stroke-width: 3;
            stroke-opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Life Expectancy: A Global Story</h1>
            <p>Exploring health outcomes across countries and time</p>
        </div>
        
        <div class="story-controls">
            <div class="story-nav">
                <button class="story-btn active" data-story="overview">Global Overview</button>
                <button class="story-btn" data-story="development">Development Status</button>
                <button class="story-btn" data-story="trends">Temporal Trends</button>
                <button class="story-btn" data-story="factors">Health Factors</button>
                <button class="story-btn" data-story="inequality">Health Inequality</button>
            </div>
        </div>
        
        <button class="back-btn" onclick="goBack()">‚Üê Back to Overview</button>
        
        <div class="visualization">
            <div id="loading" class="loading">Loading data...</div>
            <div id="chart" class="chart-container"></div>
            <div id="story-text" class="story-text"></div>
        </div>
    </div>

    <script>
        // Global variables
        let data = [];
        let currentStory = 'overview';
        let currentView = 'overview';
        let selectedCountry = null;
        
        // Color scales
        const colorScales = {
            lifeExpectancy: d3.scaleSequential(d3.interpolateRdYlBu).domain([40, 85]),
            development: d3.scaleOrdinal(d3.schemeCategory10),
            year: d3.scaleSequential(d3.interpolateViridis).domain([2000, 2015]),
            gdp: d3.scaleSequential(d3.interpolateBlues).domain([0, 50000])
        };
        
        // Story configurations
        const stories = {
            overview: {
                title: "Global Life Expectancy Overview",
                description: "Explore life expectancy across the world. Click on countries to see detailed information.",
                chartType: "world-map"
            },
            development: {
                title: "Development Status Impact",
                description: "How does development status affect life expectancy? Developed countries generally show higher life expectancy.",
                chartType: "scatter-plot"
            },
            trends: {
                title: "Temporal Trends",
                description: "Life expectancy has been increasing globally over time, but at different rates across regions.",
                chartType: "line-chart"
            },
            factors: {
                title: "Health Factors Analysis",
                description: "Explore the relationship between life expectancy and various health factors like GDP, healthcare expenditure, and disease rates.",
                chartType: "multi-scatter"
            },
            inequality: {
                title: "Health Inequality",
                description: "The gap between countries with highest and lowest life expectancy reveals global health disparities.",
                chartType: "bar-chart"
            }
        };
        
        // Load and process data
        async function loadData() {
            try {
                const csvData = await d3.csv('LifeExpectancyData/Life Expectancy Data.csv');
                
                // Clean and process data
                data = csvData.map(d => ({
                    country: d.Country,
                    year: +d.Year,
                    status: d.Status,
                    lifeExpectancy: +d['Life expectancy '] || 0,
                    adultMortality: +d['Adult Mortality'] || 0,
                    infantDeaths: +d['infant deaths'] || 0,
                    alcohol: +d.Alcohol || 0,
                    percentageExpenditure: +d['percentage expenditure'] || 0,
                    hepatitisB: +d['Hepatitis B'] || 0,
                    measles: +d['Measles '] || 0,
                    bmi: +d[' BMI '] || 0,
                    underFiveDeaths: +d['under-five deaths '] || 0,
                    polio: +d.Polio || 0,
                    totalExpenditure: +d['Total expenditure'] || 0,
                    diphtheria: +d['Diphtheria '] || 0,
                    hivAids: +d[' HIV/AIDS'] || 0,
                    gdp: +d.GDP || 0,
                    population: +d.Population || 0,
                    thinness1_19: +d[' thinness  1-19 years'] || 0,
                    thinness5_9: +d[' thinness 5-9 years'] || 0,
                    incomeComposition: +d['Income composition of resources'] || 0,
                    schooling: +d.Schooling || 0
                })).filter(d => d.lifeExpectancy > 0);
                
                document.getElementById('loading').style.display = 'none';
                initializeStory();
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('loading').innerHTML = 'Error loading data. Please check the file path.';
            }
        }
        
        // Initialize the story
        function initializeStory() {
            setupEventListeners();
            showStory('overview');
        }
        
        // Setup event listeners
        function setupEventListeners() {
            document.querySelectorAll('.story-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const story = this.getAttribute('data-story');
                    showStory(story);
                    
                    // Update active button
                    document.querySelectorAll('.story-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }
        
        // Show story
        function showStory(story) {
            currentStory = story;
            currentView = story;
            
            const storyConfig = stories[story];
            document.getElementById('story-text').innerHTML = `
                <h2>${storyConfig.title}</h2>
                <p>${storyConfig.description}</p>
            `;
            
            clearChart();
            
            switch(storyConfig.chartType) {
                case 'world-map':
                    createWorldMap();
                    break;
                case 'scatter-plot':
                    createScatterPlot();
                    break;
                case 'line-chart':
                    createLineChart();
                    break;
                case 'multi-scatter':
                    createMultiScatter();
                    break;
                case 'bar-chart':
                    createBarChart();
                    break;
            }
        }
        
        // Clear chart
        function clearChart() {
            d3.select('#chart').selectAll('*').remove();
        }
        
        // Create world map
        async function createWorldMap() {
            const width = 800;
            const height = 500;
            
            const svg = d3.select('#chart')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // Get latest data for each country
            const latestData = d3.group(data, d => d.country);
            const countryData = Array.from(latestData, ([country, values]) => ({
                country: country,
                lifeExpectancy: d3.max(values, d => d.lifeExpectancy),
                status: values[0].status,
                gdp: d3.max(values, d => d.gdp)
            }));
            
            // Create a simple world map using circles for countries
            const projection = d3.geoMercator()
                .fitSize([width, height], {type: "FeatureCollection", features: []});
            
            // Create tooltip
            const tooltip = d3.select('body').append('div')
                .attr('class', 'tooltip')
                .style('opacity', 0);
            
            // Create circles for each country
            const circles = svg.selectAll('circle')
                .data(countryData)
                .enter()
                .append('circle')
                .attr('cx', (d, i) => 100 + (i % 20) * 35)
                .attr('cy', (d, i) => 100 + Math.floor(i / 20) * 35)
                .attr('r', d => Math.sqrt(d.lifeExpectancy) * 2)
                .attr('fill', d => colorScales.lifeExpectancy(d.lifeExpectancy))
                .attr('stroke', '#fff')
                .attr('stroke-width', 1)
                .style('cursor', 'pointer')
                .on('mouseover', function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style('opacity', .9);
                    tooltip.html(`
                        <strong>${d.country}</strong><br/>
                        Life Expectancy: ${d.lifeExpectancy.toFixed(1)} years<br/>
                        Status: ${d.status}<br/>
                        GDP: $${d.gdp.toLocaleString()}
                    `)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function() {
                    tooltip.transition()
                        .duration(500)
                        .style('opacity', 0);
                })
                .on('click', function(event, d) {
                    drillDownToCountry(d.country);
                });
            
            // Add legend
            const legend = svg.append('g')
                .attr('transform', `translate(${width - 150}, 20)`);
            
            const legendScale = d3.scaleLinear()
                .domain([40, 85])
                .range([0, 100]);
            
            const legendAxis = d3.axisBottom(legendScale)
                .tickValues([40, 50, 60, 70, 80, 85])
                .tickFormat(d => d + ' years');
            
            legend.append('g')
                .attr('transform', 'translate(0, 20)')
                .call(legendAxis);
            
            // Add legend gradient
            const defs = svg.append('defs');
            const gradient = defs.append('linearGradient')
                .attr('id', 'legendGradient')
                .attr('x1', '0%')
                .attr('y1', '0%')
                .attr('x2', '100%')
                .attr('y2', '0%');
            
            gradient.append('stop')
                .attr('offset', '0%')
                .attr('stop-color', colorScales.lifeExpectancy(40));
            
            gradient.append('stop')
                .attr('offset', '100%')
                .attr('stop-color', colorScales.lifeExpectancy(85));
            
            legend.append('rect')
                .attr('width', 100)
                .attr('height', 20)
                .style('fill', 'url(#legendGradient)');
            
            legend.append('text')
                .attr('x', 0)
                .attr('y', -5)
                .text('Life Expectancy');
        }
        
        // Create scatter plot
        function createScatterPlot() {
            const width = 800;
            const height = 500;
            const margin = {top: 20, right: 30, bottom: 60, left: 60};
            
            const svg = d3.select('#chart')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // Get latest data for each country
            const latestData = d3.group(data, d => d.country);
            const countryData = Array.from(latestData, ([country, values]) => ({
                country: country,
                lifeExpectancy: d3.max(values, d => d.lifeExpectancy),
                status: values[0].status,
                gdp: d3.max(values, d => d.gdp),
                schooling: d3.max(values, d => d.schooling)
            }));
            
            const x = d3.scaleLinear()
                .domain([0, d3.max(countryData, d => d.gdp)])
                .range([margin.left, width - margin.right]);
            
            const y = d3.scaleLinear()
                .domain([0, d3.max(countryData, d => d.lifeExpectancy)])
                .range([height - margin.bottom, margin.top]);
            
            // Add axes
            svg.append('g')
                .attr('transform', `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(x).tickFormat(d => '$' + d3.format('.0s')(d)));
            
            svg.append('g')
                .attr('transform', `translate(${margin.left},0)`)
                .call(d3.axisLeft(y));
            
            // Add axis labels
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height - 10)
                .style('text-anchor', 'middle')
                .text('GDP per capita');
            
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', 15)
                .style('text-anchor', 'middle')
                .text('Life Expectancy (years)');
            
            // Add dots
            const tooltip = d3.select('body').append('div')
                .attr('class', 'tooltip')
                .style('opacity', 0);
            
            svg.selectAll('circle')
                .data(countryData)
                .enter()
                .append('circle')
                .attr('cx', d => x(d.gdp))
                .attr('cy', d => y(d.lifeExpectancy))
                .attr('r', 5)
                .attr('fill', d => colorScales.development(d.status))
                .style('cursor', 'pointer')
                .on('mouseover', function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style('opacity', .9);
                    tooltip.html(`
                        <strong>${d.country}</strong><br/>
                        Life Expectancy: ${d.lifeExpectancy.toFixed(1)} years<br/>
                        GDP: $${d.gdp.toLocaleString()}<br/>
                        Status: ${d.status}
                    `)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function() {
                    tooltip.transition()
                        .duration(500)
                        .style('opacity', 0);
                });
            
            // Add legend
            const legend = svg.append('g')
                .attr('transform', `translate(${width - 100}, 20)`);
            
            const statuses = [...new Set(countryData.map(d => d.status))];
            
            statuses.forEach((status, i) => {
                const legendItem = legend.append('g')
                    .attr('transform', `translate(0, ${i * 25})`);
                
                legendItem.append('circle')
                    .attr('r', 5)
                    .attr('fill', colorScales.development(status));
                
                legendItem.append('text')
                    .attr('x', 15)
                    .attr('y', 5)
                    .text(status);
            });
        }
        
        // Create line chart
        function createLineChart() {
            const width = 800;
            const height = 500;
            const margin = {top: 20, right: 30, bottom: 60, left: 60};
            
            const svg = d3.select('#chart')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // Aggregate data by year and status
            const yearData = d3.group(data, d => d.year, d => d.status);
            const lineData = Array.from(yearData, ([year, statusGroups]) => {
                const result = {year: year};
                statusGroups.forEach((values, status) => {
                    result[status] = d3.mean(values, d => d.lifeExpectancy);
                });
                return result;
            }).sort((a, b) => a.year - b.year);
            
            const x = d3.scaleLinear()
                .domain(d3.extent(lineData, d => d.year))
                .range([margin.left, width - margin.right]);
            
            const y = d3.scaleLinear()
                .domain([0, d3.max(lineData, d => Math.max(d.Developed || 0, d.Developing || 0))])
                .range([height - margin.bottom, margin.top]);
            
            // Add axes
            svg.append('g')
                .attr('transform', `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(x).tickFormat(d3.format('d')));
            
            svg.append('g')
                .attr('transform', `translate(${margin.left},0)`)
                .call(d3.axisLeft(y));
            
            // Add axis labels
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height - 10)
                .style('text-anchor', 'middle')
                .text('Year');
            
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', 15)
                .style('text-anchor', 'middle')
                .text('Life Expectancy (years)');
            
            // Create line generator
            const line = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.value));
            
            // Add lines for each status
            const statuses = ['Developed', 'Developing'];
            statuses.forEach(status => {
                const statusData = lineData.filter(d => d[status] !== undefined)
                    .map(d => ({year: d.year, value: d[status]}));
                
                svg.append('path')
                    .datum(statusData)
                    .attr('fill', 'none')
                    .attr('stroke', colorScales.development(status))
                    .attr('stroke-width', 3)
                    .attr('d', line);
                
                // Add dots
                svg.selectAll(`.dot-${status}`)
                    .data(statusData)
                    .enter()
                    .append('circle')
                    .attr('class', `dot-${status}`)
                    .attr('cx', d => x(d.year))
                    .attr('cy', d => y(d.value))
                    .attr('r', 4)
                    .attr('fill', colorScales.development(status));
            });
            
            // Add legend
            const legend = svg.append('g')
                .attr('transform', `translate(${width - 100}, 20)`);
            
            statuses.forEach((status, i) => {
                const legendItem = legend.append('g')
                    .attr('transform', `translate(0, ${i * 25})`);
                
                legendItem.append('line')
                    .attr('x1', 0)
                    .attr('x2', 20)
                    .attr('y1', 0)
                    .attr('y2', 0)
                    .attr('stroke', colorScales.development(status))
                    .attr('stroke-width', 3);
                
                legendItem.append('text')
                    .attr('x', 25)
                    .attr('y', 5)
                    .text(status);
            });
        }
        
        // Create multi-scatter plot
        function createMultiScatter() {
            const width = 800;
            const height = 500;
            const margin = {top: 20, right: 30, bottom: 60, left: 60};
            
            const svg = d3.select('#chart')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // Get latest data for each country
            const latestData = d3.group(data, d => d.country);
            const countryData = Array.from(latestData, ([country, values]) => ({
                country: country,
                lifeExpectancy: d3.max(values, d => d.lifeExpectancy),
                gdp: d3.max(values, d => d.gdp),
                schooling: d3.max(values, d => d.schooling),
                bmi: d3.max(values, d => d.bmi),
                status: values[0].status
            }));
            
            const x = d3.scaleLinear()
                .domain([0, d3.max(countryData, d => d.schooling)])
                .range([margin.left, width - margin.right]);
            
            const y = d3.scaleLinear()
                .domain([0, d3.max(countryData, d => d.lifeExpectancy)])
                .range([height - margin.bottom, margin.top]);
            
            // Add axes
            svg.append('g')
                .attr('transform', `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(x));
            
            svg.append('g')
                .attr('transform', `translate(${margin.left},0)`)
                .call(d3.axisLeft(y));
            
            // Add axis labels
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height - 10)
                .style('text-anchor', 'middle')
                .text('Years of Schooling');
            
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', 15)
                .style('text-anchor', 'middle')
                .text('Life Expectancy (years)');
            
            // Add dots
            const tooltip = d3.select('body').append('div')
                .attr('class', 'tooltip')
                .style('opacity', 0);
            
            svg.selectAll('circle')
                .data(countryData)
                .enter()
                .append('circle')
                .attr('cx', d => x(d.schooling))
                .attr('cy', d => y(d.lifeExpectancy))
                .attr('r', d => Math.sqrt(d.bmi) / 2)
                .attr('fill', d => colorScales.development(d.status))
                .attr('opacity', 0.7)
                .style('cursor', 'pointer')
                .on('mouseover', function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style('opacity', .9);
                    tooltip.html(`
                        <strong>${d.country}</strong><br/>
                        Life Expectancy: ${d.lifeExpectancy.toFixed(1)} years<br/>
                        Schooling: ${d.schooling.toFixed(1)} years<br/>
                        BMI: ${d.bmi.toFixed(1)}<br/>
                        Status: ${d.status}
                    `)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function() {
                    tooltip.transition()
                        .duration(500)
                        .style('opacity', 0);
                });
        }
        
        // Create bar chart
        function createBarChart() {
            const width = 800;
            const height = 500;
            const margin = {top: 20, right: 30, bottom: 60, left: 60};
            
            const svg = d3.select('#chart')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            // Get latest data for each country
            const latestData = d3.group(data, d => d.country);
            const countryData = Array.from(latestData, ([country, values]) => ({
                country: country,
                lifeExpectancy: d3.max(values, d => d.lifeExpectancy),
                status: values[0].status
            }));
            
            // Sort by life expectancy and get top/bottom 10
            const sortedData = countryData.sort((a, b) => b.lifeExpectancy - a.lifeExpectancy);
            const top10 = sortedData.slice(0, 10);
            const bottom10 = sortedData.slice(-10).reverse();
            
            const chartData = [...top10, ...bottom10];
            
            const x = d3.scaleBand()
                .domain(chartData.map(d => d.country))
                .range([margin.left, width - margin.right])
                .padding(0.1);
            
            const y = d3.scaleLinear()
                .domain([0, d3.max(chartData, d => d.lifeExpectancy)])
                .range([height - margin.bottom, margin.top]);
            
            // Add axes
            svg.append('g')
                .attr('transform', `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(x))
                .selectAll('text')
                .attr('transform', 'rotate(-45)')
                .style('text-anchor', 'end');
            
            svg.append('g')
                .attr('transform', `translate(${margin.left},0)`)
                .call(d3.axisLeft(y));
            
            // Add axis labels
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height - 10)
                .style('text-anchor', 'middle')
                .text('Country');
            
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', 15)
                .style('text-anchor', 'middle')
                .text('Life Expectancy (years)');
            
            // Add bars
            const tooltip = d3.select('body').append('div')
                .attr('class', 'tooltip')
                .style('opacity', 0);
            
            svg.selectAll('rect')
                .data(chartData)
                .enter()
                .append('rect')
                .attr('x', d => x(d.country))
                .attr('y', d => y(d.lifeExpectancy))
                .attr('width', x.bandwidth())
                .attr('height', d => height - margin.bottom - y(d.lifeExpectancy))
                .attr('fill', d => colorScales.development(d.status))
                .style('cursor', 'pointer')
                .on('mouseover', function(event, d) {
                    tooltip.transition()
                        .duration(200)
                        .style('opacity', .9);
                    tooltip.html(`
                        <strong>${d.country}</strong><br/>
                        Life Expectancy: ${d.lifeExpectancy.toFixed(1)} years<br/>
                        Status: ${d.status}
                    `)
                        .style('left', (event.pageX + 10) + 'px')
                        .style('top', (event.pageY - 28) + 'px');
                })
                .on('mouseout', function() {
                    tooltip.transition()
                        .duration(500)
                        .style('opacity', 0);
                });
            
            // Add divider line
            svg.append('line')
                .attr('x1', margin.left)
                .attr('x2', width - margin.right)
                .attr('y1', y(top10[9].lifeExpectancy))
                .attr('y2', y(top10[9].lifeExpectancy))
                .attr('stroke', '#e74c3c')
                .attr('stroke-width', 2)
                .attr('stroke-dasharray', '5,5');
            
            // Add labels
            svg.append('text')
                .attr('x', width - margin.right + 10)
                .attr('y', y(top10[9].lifeExpectancy) + 5)
                .text('Top 10')
                .attr('fill', '#e74c3c');
            
            svg.append('text')
                .attr('x', width - margin.right + 10)
                .attr('y', y(bottom10[0].lifeExpectancy) - 5)
                .text('Bottom 10')
                .attr('fill', '#e74c3c');
        }
        
        // Drill down to country
        function drillDownToCountry(country) {
            selectedCountry = country;
            currentView = 'country-detail';
            
            document.querySelector('.back-btn').style.display = 'block';
            
            const countryData = data.filter(d => d.country === country);
            
            clearChart();
            
            const width = 800;
            const height = 500;
            const margin = {top: 20, right: 30, bottom: 60, left: 60};
            
            const svg = d3.select('#chart')
                .append('svg')
                .attr('width', width)
                .attr('height', height);
            
            const x = d3.scaleLinear()
                .domain(d3.extent(countryData, d => d.year))
                .range([margin.left, width - margin.right]);
            
            const y = d3.scaleLinear()
                .domain([0, d3.max(countryData, d => d.lifeExpectancy)])
                .range([height - margin.bottom, margin.top]);
            
            // Add axes
            svg.append('g')
                .attr('transform', `translate(0,${height - margin.bottom})`)
                .call(d3.axisBottom(x).tickFormat(d3.format('d')));
            
            svg.append('g')
                .attr('transform', `translate(${margin.left},0)`)
                .call(d3.axisLeft(y));
            
            // Add axis labels
            svg.append('text')
                .attr('x', width / 2)
                .attr('y', height - 10)
                .style('text-anchor', 'middle')
                .text('Year');
            
            svg.append('text')
                .attr('transform', 'rotate(-90)')
                .attr('x', -height / 2)
                .attr('y', 15)
                .style('text-anchor', 'middle')
                .text('Life Expectancy (years)');
            
            // Add line
            const line = d3.line()
                .x(d => x(d.year))
                .y(d => y(d.lifeExpectancy));
            
            svg.append('path')
                .datum(countryData)
                .attr('fill', 'none')
                .attr('stroke', '#3498db')
                .attr('stroke-width', 3)
                .attr('d', line);
            
            // Add dots
            svg.selectAll('circle')
                .data(countryData)
                .enter()
                .append('circle')
                .attr('cx', d => x(d.year))
                .attr('cy', d => y(d.lifeExpectancy))
                .attr('r', 5)
                .attr('fill', '#3498db');
            
            // Update story text
            const latest = countryData[countryData.length - 1];
            const earliest = countryData[0];
            const change = latest.lifeExpectancy - earliest.lifeExpectancy;
            
            document.getElementById('story-text').innerHTML = `
                <h2>${country} - Life Expectancy Trend</h2>
                <p>From ${earliest.year} to ${latest.year}, life expectancy in ${country} ${change > 0 ? 'increased' : 'decreased'} by ${Math.abs(change).toFixed(1)} years.</p>
                <p>Current life expectancy: ${latest.lifeExpectancy.toFixed(1)} years</p>
                <p>Development status: ${latest.status}</p>
            `;
        }
        
        // Go back function
        function goBack() {
            selectedCountry = null;
            currentView = currentStory;
            document.querySelector('.back-btn').style.display = 'none';
            showStory(currentStory);
        }
        
        // Initialize the application
        loadData();
    </script>
</body>
</html> 
